#!/usr/bin/env python

from __future__ import print_function

import sys

import lp


if __name__ == '__main__':
    try:
        if len(sys.argv) == 6:
            count = int(sys.argv.pop(-1))
        else:
            count = 10

        _, locked, targets, unclaimed, owned = [
            a if a != '-' else '' for a in sys.argv
        ]
    except ValueError:
        print('USAGE: lp LOCKED TARGETS UNCLAIMED OWNED [COUNT]\n'
              'see README.rst for more details.')
        sys.exit(1)

    unclaimable = locked + owned
    available = targets + unclaimed + unclaimable

    if len(available) != 5 * 5:
        print('You provided {} letters. That is not a letterpress grid.'
              .format(len(available)))
        sys.exit(1)

    home = len(owned)
    away = len(targets + locked)

    unclaimed_plural = len(unclaimed) != 1

    print(
        'The current score is {home}-{away}. There {are} {unclaimed} '
        'tile{plural} left.'
        .format(
            home=home,
            away=away,
            unclaimed=len(unclaimed),
            plural='s' if unclaimed_plural else '',
            are='are' if unclaimed_plural else 'is',
        )
    )

    playable = lp.get_unique_playable_words(available)

    print('\n'.join((
        '{:>3} - {}'.format('win' if s == float('inf') else s, w)
        for w, s in
        lp.get_best_words(playable, targets, unclaimed, away-home)[:count]
    )))
